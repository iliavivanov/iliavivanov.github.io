<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <title>Camera API</title>
    <link rel="stylesheet" href="css/base.css" type="text/css" media="screen">
</head>

<body>

<div class="container">
    <h1>Camera API</h1>

    <div id="container">
        <canvas id="picture" width="320" height="240"></canvas>
        <input id="take-picture" type="file" accept="image/*;capture=camera"/>
        <img id="show-picture" src="" alt="">

        <p id="result"></p>
    </div>

</div>


<script>
    (function () {
        var takePicture = document.querySelector("#take-picture"),
                showPicture = document.querySelector("#show-picture"),
                canvas = document.querySelector("#picture"),
                ctx = canvas.getContext("2d"),
                result = document.querySelector("#error");

        if(takePicture && showPicture) {
            takePicture.onchange = function (event) {
                var files = event.target.files;
                if (files && files.length > 0) {
                    file = files[0];
                    try {
                        var URL = window.URL || window.webkitURL;
                        showPicture.onload = function(event) {
                            result.innerHTML="";
                            // JOB.DecodeImage(showPicture);
                            URL.revokeObjectURL(showPicture.src);
                        };
                        showPicture.src = URL.createObjectURL(file);
                    }
                    catch (e) {
                        try {
                            var fileReader = new FileReader();
                            fileReader.onload = function (event) {
                                showPicture.onload = function(event) {
                                    result.innerHTML="";
                                    console.log("filereader");
                                    //JOB.DecodeImage(showPicture);
                                };
                                showPicture.src = event.target.result;
                            };
                            fileReader.readAsDataURL(file);
                        }
                        catch (e) {
                            result.innerHTML = "Neither createObjectURL or FileReader are supported";
                        }
                    }
                }
            };
        }



        /*
        if (takePicture && showPicture) {
            // Set events
            takePicture.onchange = function (event) {
                // Get a reference to the taken picture or chosen file
                var files = event.target.files,
                        file;
                if (files && files.length > 0) {
                    file = files[0];
                    try {
                        // Create ObjectURL
                        var imgURL = window.URL.createObjectURL(file);

                        // Set img src to ObjectURL
                        showPicture.src = imgURL;

                        // Revoke ObjectURL
                        URL.revokeObjectURL(imgURL);
                    }
                    catch (e) {
                        try {
                            // Fallback if createObjectURL is not supported
                            var fileReader = new FileReader();
                            fileReader.onload = function (event) {
                                showPicture.src = event.target.result;
                            };
                            fileReader.readAsDataURL(file);
                        }
                        catch (e) {
                            //
                            if (result) {
                                result.innerHTML = "Neither createObjectURL or FileReader are supported";
                            }
                        }
                    }
                }
            };
        }
        */
    })();


</script>


</body>
</html>